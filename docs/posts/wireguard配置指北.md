# wireguard 配置指北 #

## 一、熟悉linix相关命令 ##

####  1. sudo

sudo的全称是“substitute user do”,意思是以其他用户的身份执行命令。

当在命令前面加上sudo时,系统会提示输入当前用户的密码,经过认证后,就可以临时获取root账户的所有权限,执行对应的命令。

sudo的作用主要有:

1. 提高安全性:不需要直接登录root账户就可以执行管理员命令。
2. 进行权限控制:系统管理员可以通过设置sudoers文件,指定哪些用户可以使用sudo以及执行哪些命令,实现精细化的权限控制。
3. 进行操作审计:sudo会记录命令执行日志,便于追踪操作和审计。
4. 提高灵活性:不同用户可以对不同命令使用sudo,不需要共享root密码。
5. 提供模拟环境:通过sudo可以模拟其他用户,测试执行命令的效果。

#### 2. cat ####

cat通常作为缩写来自“concatenate”,意为连接。

cat命令的主要用途包括:

1. 显示文本文件内容:cat filename可以显示filename文件的内容。
2. 连接文本文件:cat file1 file2 可以将file1和file2连接起来显示。
3. 创建文本文件:cat > filename可以创建一个新的文件。
4. 追加文本文件:cat >> filename 可以向文件末尾追加内容。
5. 显示行号:cat -n filename可以同时显示行号。
6. 显示不可见字符:cat -v/-e filename可以显示tab,换行等不可见字符。

#### 3. tee ####

tee是Linux系统中的一个命令,它的作用是读取标准输入的数据,并同时输出到标准输出和文件。

tee名字来源于字面意思,就像T形的管道一样,可以将输入"分流"到多个输出。

tee命令的语法格式为:

```shell
tee [选项] [文件]
```

常见的用法示例:

- `ls | tee file.txt` 将ls命令的标准输出同时打印到终端和file.txt文件
- `cat file.txt | tee -a file.txt` 将file.txt内容同时打印并追加到file.txt
- `echo "test" | tee file1 file2` 将"test"同时输出到file1和file2

tee支持的主要选项包括:

- -a:追加到文件末尾,不覆盖原内容
- -i:忽略中断信号,保证完全写入
- -p:保留原输文件夹权限

#### 4. | (管道符号)(重要！！！

|在Linux系统中的shell和命令行中,代表管道符号(pipeline)。

它的作用是将一个命令或程序的标准输出作为下一个命令或程序的标准输入。实现两个命令之间的数据流向的重定向。

例如:

```
ps aux | grep ssh
```

这里ps aux命令将所有进程的信息输出,通过|管道连接grep ssh命令,将ps aux的输出作为grep ssh的输入来过滤出所有包含ssh的进程。

另一个例子:

```
cat file.txt | wc -l
```

cat命令将文件内容输出,管道连接wc -l命令来统计行数。

管道的重要功能包括:

- 将一个命令的输出传递给下一个命令
- 连接两个命令,实现组合多功能
- 避免创建中间临时文件

#### 5. > (重定向符号) ####

\>的作用是将命令或程序的标准输出重定向到指定的文件中,而不是打印到终端界面。

例如:

```
ls -l > file.txt
```

这条命令会将ls -l的目录列表输出重定向到file.txt文件中,而不会打印在屏幕上。

另一个例子:

```
echo "hello" > test.sh 
```

会将"hello"字符串输出到test.sh文件中,文件内容就是"hello"。

\>的重要功能包括:

- 输出重定向,将内容输出到文件中
- 创建新文件,以输出内容创建文件
- 覆盖旧文件,新内容会覆盖旧文件内容

注意:标准错误输出(stderr)不会被重定向。

熟练运用重定向符号,可以实现命令执行过程中动态创建文件、保存输出等功能,大大提高Shell使用效率。

## 二、配置流程 

### 0. 配置须知 ###

首先需要知道，在通常情况下，服务端只需要配置`inteface`部分，而客户端只需要配置`peer`部分。这是WireGuard的标准用法。

服务端通常负责监听连接请求，因此它配置了接口的详细信息，包括本地地址、私钥和监听端口。服务端接口的 `Address` 是服务端的本地IP地址，`PrivateKey` 是服务端的私钥，而 `ListenPort` 是服务端用于监听客户端连接请求的端口。

客户端连接到服务端，因此客户端配置的重点在于定义与服务端的连接信息。客户端需要知道服务端的公钥（`PublicKey`）、允许通过VPN隧道的IP地址范围（`AllowedIPs`），以及服务端的终端点信息（`Endpoint`）。

### 1. 服务端配置 ###

**Interface（接口）：**

- `Interface` 部分定义了WireGuard VPN接口的设置。
- 每个配置文件中只能有一个 `interface` 部分，它通常位于配置文件的顶部。
- `Address`：指定本地接口的IPv4或IPv6地址。这是VPN接口的本地地址。
- `PrivateKey`：指定本地接口的私钥，用于加密通信和身份验证。
- `ListenPort`：指定接口监听的端口，用于接收来自对等端的连接请求。
- `DNS`（可选）：用于指定DNS服务器地址，以便客户端可以路由其DNS查询通过VPN。
- `MTU`（可选）：用于设置最大传输单元（MTU），控制数据包的最大大小。

### 2. 客户端配置 ###

**Peer（对等端）：**

- `Peer` 部分用于配置与特定对等端的连接信息。您可以在一个配置文件中定义多个 `peer` 来允许多个客户端连接到服务端。
- 每个 `peer`包括以下信息：
  - `PublicKey`：对等端的公钥，用于对等端的身份验证和加密通信。
  - `AllowedIPs`：指定了允许通过VPN隧道的IP地址范围。通常，这包括客户端本地网络的子网范围。
  - `Endpoint`：指定对等端的公共IP地址和端口，以便与对等端建立连接。
  - `PersistentKeepalive`（可选）：用于配置保持连接的心跳间隔，以防止连接超时。